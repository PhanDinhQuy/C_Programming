bool isValid(const char *s) {
    if (!s) return false;
    int length = (int)strlen(s);
    if (length % 2 == 1) return false;

    char *stack = malloc((size_t)length * sizeof *stack);
    if (!stack) return false;

    int top = -1;
    for (int i = 0; i < length; ++i) {
        char c = s[i];
        if (c == '(' || c == '{' || c == '[') {
            // push
            stack[++top] = c;
        } else if (c == ')' || c == '}' || c == ']') {
            if (top == -1) {
                free(stack);
                return false;
            }
            char d = stack[top--]; // pop
            if (!((c == ')' && d == '(') ||
                  (c == '}' && d == '{') ||
                  (c == ']' && d == '['))) {
                free(stack);
                return false;
            }
        } else {
            free(stack);
            return false;
        }
    }

    bool valid = (top == -1);
    free(stack);
    return valid;
}
